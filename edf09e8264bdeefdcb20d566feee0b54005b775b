{
  "comments": [
    {
      "key": {
        "uuid": "1a767f21_f0bc9877",
        "filename": "policy-db-migrator/src/main/docker/config/policyadmin/sql/0900/downgrade/0120-JpaPolicyAuditIndex_timestamp.sql",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 811
      },
      "writtenOn": "2021-07-13T13:51:29Z",
      "side": 1,
      "message": "do we need a corresponding \"upgrade\" script",
      "revId": "edf09e8264bdeefdcb20d566feee0b54005b775b",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "66826888_4414b96c",
        "filename": "policy-db-migrator/src/main/docker/config/policyadmin/sql/0900/downgrade/0120-JpaPolicyAuditIndex_timestamp.sql",
        "patchSetId": 6
      },
      "lineNbr": 0,
      "author": {
        "id": 7668
      },
      "writtenOn": "2021-07-13T14:09:29Z",
      "side": 1,
      "message": "Upgrade script is present: https://gerrit.onap.org/r/c/policy/docker/+/122460/6/policy-db-migrator/src/main/docker/config/policyadmin/sql/0900/upgrade/0120-JpaPolicyAuditIndex_timestamp.sql\nyou may need to hit the \"Show All\" button to see it",
      "parentUuid": "1a767f21_f0bc9877",
      "revId": "edf09e8264bdeefdcb20d566feee0b54005b775b",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": false
    },
    {
      "key": {
        "uuid": "53bdf9c6_3f1a5102",
        "filename": "policy-db-migrator/src/main/docker/config/policyadmin/sql/0900/downgrade/0120-JpaPolicyAuditIndex_timestamp.sql",
        "patchSetId": 6
      },
      "lineNbr": 20,
      "author": {
        "id": 811
      },
      "writtenOn": "2021-07-13T13:51:29Z",
      "side": 1,
      "message": "probably don\u0027t need to enable/disable this when dropping (or creating) an index",
      "revId": "edf09e8264bdeefdcb20d566feee0b54005b775b",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "9f72f3c4_5796b719",
        "filename": "policy-db-migrator/src/main/docker/config/policyadmin/sql/0900/downgrade/0120-JpaPolicyAuditIndex_timestamp.sql",
        "patchSetId": 6
      },
      "lineNbr": 20,
      "author": {
        "id": 7668
      },
      "writtenOn": "2021-07-13T14:09:29Z",
      "side": 1,
      "message": "We only really needs this when there is an index on a foreign key.\nIf it\u0027s not there you\u0027ll see any error like:\ndrools-db-migration    | ERROR 1553 (HY000) at line 22: Cannot drop index \u0027TscaServiceTemplatetopologyTemplateParentLocalName\u0027: needed in a foreign key constraint\ndrools-db-migration    | DROP INDEX TscaServiceTemplatetopologyTemplateParentLocalName ON toscaservicetemplate\nI thought it would be easier to include it for all indexes.",
      "parentUuid": "53bdf9c6_3f1a5102",
      "revId": "edf09e8264bdeefdcb20d566feee0b54005b775b",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "97afe808_d2d9f7d5",
        "filename": "policy-db-migrator/src/main/docker/config/policyadmin/sql/0900/downgrade/0120-JpaPolicyAuditIndex_timestamp.sql",
        "patchSetId": 6
      },
      "lineNbr": 20,
      "author": {
        "id": 811
      },
      "writtenOn": "2021-07-13T14:14:03Z",
      "side": 1,
      "message": "wouldn\u0027t it still generate an error when FK checks are re-enabled?",
      "parentUuid": "9f72f3c4_5796b719",
      "revId": "edf09e8264bdeefdcb20d566feee0b54005b775b",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "6f72511e_ba0f745e",
        "filename": "policy-db-migrator/src/main/docker/config/policyadmin/sql/0900/downgrade/0120-JpaPolicyAuditIndex_timestamp.sql",
        "patchSetId": 6
      },
      "lineNbr": 20,
      "author": {
        "id": 7668
      },
      "writtenOn": "2021-07-13T14:20:27Z",
      "side": 1,
      "message": "No it doesn\u0027t.\nThe script will run to the end and all indexes, constraints and tables are dropped.\nWithout it the script fails on the first downgrade script because they are run in reverse order.",
      "parentUuid": "97afe808_d2d9f7d5",
      "revId": "edf09e8264bdeefdcb20d566feee0b54005b775b",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    },
    {
      "key": {
        "uuid": "da54917c_12436e0d",
        "filename": "policy-db-migrator/src/main/docker/config/policyadmin/sql/0900/downgrade/0120-JpaPolicyAuditIndex_timestamp.sql",
        "patchSetId": 6
      },
      "lineNbr": 20,
      "author": {
        "id": 811
      },
      "writtenOn": "2021-07-13T14:25:18Z",
      "side": 1,
      "message": "I\u0027m imagining this scenario:\n\n  script 1:\n    set FK\u003d0\n    drop index 1\n    set FK\u003d1\n\n  script 2:\n    set FK\u003d0\n    drop index 2\n    set FK\u003d1\n\nif dropping index 1 causes a violation, then I would expect it to generate a violation as soon as FK\u003d1 is executed, which happens before script 2 is executed",
      "parentUuid": "6f72511e_ba0f745e",
      "revId": "edf09e8264bdeefdcb20d566feee0b54005b775b",
      "serverId": "14b4e41f-c4e3-4fb9-9955-6a9b5656895a",
      "unresolved": true
    }
  ]
}